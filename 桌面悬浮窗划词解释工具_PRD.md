# 桌面悬浮窗划词解释工具 - 产品需求文档 (PRD)

## 1. 产品概述
本项目旨在开发一款轻量级的桌面端辅助工具。用户在任何电脑软件中（如浏览器、Word、PDF阅读器、写代码的IDE等）使用鼠标划选一段文本后，按下快捷键（默认 `Shift`），即可在鼠标光标附近召唤出一个极简的悬浮窗。该悬浮窗将请求大语言模型（LLM）对选中的词语、句子或概念进行智能解释、翻译或润色。

## 2. 目标用户与核心痛点
- **目标用户**：常需阅读外文文献的学生、处理长篇文档的职场人士、以及需要快速查阅专业术语的开发者。
- **用户痛点**：传统的查词/查概念方式需要频繁切换窗口（复制内容 -> 切换到浏览器或翻译软件 -> 粘贴 -> 搜索），不仅打断思维连贯性（心流），而且操作繁琐，效率低下。

## 3. 核心业务流程 (User Flow)
1. **启动与常驻**：用户打开软件，软件在后台静默运行（仅在系统托盘显示一个小图标）。
2. **划线选中**：用户在任意界面用鼠标左键划选目标文本（高亮文字）。
3. **快捷触发**：用户按下 `Shift` 键。
4. **获取内容与请求**：软件自动提取选中的文本，并将其与预设的“提示词”组装，发送给云端的大模型。
5. **结果展示**：在鼠标当前位置旁边弹出一个半透明/无边框的悬浮窗，像打字机一样（流式）输出大模型的解释内容。
6. **一键关闭**：用户阅读完毕后，只需点击屏幕的任意其他空白处，或按下 `Esc` 键，悬浮窗自动消失，用户继续原先的工作。

## 4. 功能需求列表 (Functional Requirements)

| 功能模块 | 功能名称 | 详细说明 | 优先级 |
|---|---|---|---|
| **A. 触发模块** | 划词检测 | 监听全局鼠标和键盘事件，识别选中动作和 `Shift` 键按下。 | **P0** (核心) |
| **A. 触发模块** | 文本提取 | 自动模拟 `Ctrl+C` 将选中内容复制到系统剪贴板并读取。 | **P0** |
| **B. AI 请求** | 接口配置 | 支持用户在设置中配置 LLM 的 API Key 和模型接口地址（支持 DeepSeek, ChatGPT, 通义千问等）。 | **P0** |
| **B. AI 请求** | 提示词构建 | 内置默认 Prompt（如：“请简明扼要地解释以下内容：[文本]”），并支持用户自定义不同的 Prompt 模板（如：“请帮我翻译成英文”）。 | P1 |
| **B. AI 请求** | 流式接收 | 支持 Stream 流式输出，让文字一个一个蹦出来，消除等待焦虑。 | **P0** |
| **C. 展现模块** | 跟随弹窗 | 获取鼠标当前 X,Y 坐标，在其右下方计算合适位置渲染悬浮窗（需防止窗口超出屏幕边缘）。 | **P0** |
| **C. 展现模块** | UI 渲染 | 悬浮窗需支持 Markdown 格式渲染（加粗、列表、代码块等），内容过长时支持鼠标滚轮向下滚动。 | P1 |
| **C. 展现模块** | 自动隐藏 | 失去焦点（点击窗口外）或按下 `Esc` 时立刻销毁/隐藏悬浮窗。 | **P0** |
| **D. 设置模块** | 托盘菜单 | 右下角系统托盘图标，右键可打开“设置面板”或“退出应用”。 | P1 |
| **D. 设置模块** | 快捷键修改 | 允许用户将触发键从 `Shift` 修改为其他习惯的组合键（如 `Alt+Q`）。 | P2 |

## 5. 交互与UI设计要求
- **悬浮窗视觉**：
  - **风格**：亚克力/毛玻璃半透明效果（Glassmorphism），大圆角，无边框设计，体现现代感。
  - **配色**：提供深色（Dark）和浅色（Light）两套主题，最好能跟随操作系统自身的主题。
  - **加载状态**：在 AI 回复卡顿或网络延迟时，显示柔和的“呼吸灯”特效或“正在思考...”的微动画。
- **异常交互处理**：
  - **未选中文字**：如果在没选中任何文字的情况下按下了 Shift，在鼠标位置弹出一个极其轻量的提示（Toast）：“未检测到选中内容”，2秒后自动消失。
  - **网络/大模型配置错误**：在悬浮窗内用红色友好的文字提示错误原因（如：“API 密钥好像填错了哦，请去右下角设置里检查一下”）。

## 6. 技术实现核心原理解释
*按照您的特殊需求，对本产品最重要的核心技术点——【获取你选中的文字】——提供两种视角的解释：*

### 👨‍💻 方式 1：标准的解释方式
划词提取模块依赖于**操作系统级全局钩子（Global Hook）**与**操作底层剪贴板（Clipboard API）**的协同：
1. 程序调用 Windows 底层的 User32 API 注册一个低级键盘事件监听器（`WH_KEYBOARD_LL`）。
2. 当拦截到 `Shift` 键（虚拟键码 `VK_SHIFT`）的 `KeyDown`（按下）事件时，触发回调函数。
3. 为了跨软件获取文本，程序无法直接读取每个软件的内部内存，因此采用通用机制：主线程合成模拟输入，向系统事件队列中压入 `Ctrl + C` 的虚拟按键组合。
4. 程序执行短暂的异步挂起（Sleep 约100毫秒），等待目标软件的 UI 线程完成复制并写入操作系统的全局剪贴板内存中。
5. 最后，程序调用系统剪贴板读取接口，以纯文本（Text）格式取出缓冲区中的字符串数据，便成功获取到了用户选中的文本。

### 🧒 方式 2：把我当成12岁的小学生，提供的形象解释
想象你的电脑里藏着一个随时待命的“影子小特工”，他要完成的任务就是把你划中的字送给 AI 老爷爷。
1. **暗中盯梢**：小特工平时隐身躲在屏幕玻璃后面，一双眼睛死死盯着你的手。当你在网页上涂黑了一段字，然后手指“啪”地碰了一下 `Shift` 键，小特工立刻行动！
2. **闪电手速**：小特工有一个绝活，就是他的手速比世界上最厉害的游戏高手还要快一千倍！他瞬间抢过你的键盘，帮你偷偷按了一下 `Ctrl` 和 `C` 键（也就是我们在电脑上常用的“复制”快捷键）。
3. **搜小书包**：你的电脑被小特工骗了，以为是你自己点了复制，所以它乖乖地把你涂黑的那句话装进了一个叫“剪贴板”的隐身小书包里。小特工趁电脑不注意，把手伸进小书包，把那句话掏出来，然后一路狂奔去给 AI 发求助短信啦！
这一切都发生在一眨眼的功夫，你只能看到屏幕上直接弹出了 AI 给你解释好的魔法小窗口！
